/**
 * Admin Notification Types
 * ê´€ë¦¬ì ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œì„ ìœ„í•œ íƒ€ì… ì •ì˜
 */

export interface AdminNotification {
  id: string;
  type: AdminNotificationType;
  priority: AdminNotificationPriority;
  category: NotificationCategory;
  title: string;
  message: string;
  actionUrl?: string;
  actionLabel?: string;
  isRead: boolean;
  metadata: NotificationMetadata;
  createdAt: Date;
  expiresAt?: Date;
  acknowledgedAt?: Date;
  acknowledgedBy?: string; // Admin user ID
}

export enum AdminNotificationType {
  // ì¶œê¸ˆ ê´€ë ¨
  WITHDRAWAL_PENDING = "withdrawal_pending",
  WITHDRAWAL_AML_FLAG = "withdrawal_aml_flag",
  WITHDRAWAL_FAILED = "withdrawal_failed",
  WITHDRAWAL_COMPLETED = "withdrawal_completed",

  // ì…ê¸ˆ ê´€ë ¨
  DEPOSIT_RECEIVED = "deposit_received",
  DEPOSIT_AML_FLAG = "deposit_aml_flag",
  DEPOSIT_RETURNED = "deposit_returned",
  TRAVEL_RULE_VIOLATION = "travel_rule_violation",

  // ë³¼íŠ¸ ê´€ë ¨
  VAULT_REBALANCING_NEEDED = "vault_rebalancing_needed",
  VAULT_REBALANCING_COMPLETED = "vault_rebalancing_completed",
  VAULT_HOT_WALLET_LOW = "vault_hot_wallet_low",
  VAULT_SECURITY_ALERT = "vault_security_alert",

  // íšŒì›ì‚¬ ê´€ë ¨
  MEMBER_ONBOARDING_PENDING = "member_onboarding_pending",
  MEMBER_SUSPENDED = "member_suspended",
  MEMBER_ADDRESS_FLAGGED = "member_address_flagged",

  // ì‹œìŠ¤í…œ ê´€ë ¨
  SYSTEM_ERROR = "system_error",
  SYSTEM_MAINTENANCE = "system_maintenance",
  SECURITY_ALERT = "security_alert",
  COMPLIANCE_ALERT = "compliance_alert",

  // ê´€ë¦¬ì ê´€ë ¨
  ADMIN_LOGIN_SUSPICIOUS = "admin_login_suspicious",
  ADMIN_SESSION_EXPIRING = "admin_session_expiring",
  PERMISSION_CHANGED = "permission_changed"
}

export enum AdminNotificationPriority {
  CRITICAL = "critical",    // ğŸ”´ Red - ì¦‰ê° ì¡°ì¹˜ í•„ìš”
  HIGH = "high",           // ğŸŸ¡ Yellow - 1ì‹œê°„ ë‚´ ì¡°ì¹˜
  NORMAL = "normal",       // ğŸ”µ Blue - ë‹¹ì¼ ë‚´ í™•ì¸
  LOW = "low"             // âšª Gray - ì°¸ê³ ìš©
}

export enum NotificationCategory {
  SECURITY = "security",
  COMPLIANCE = "compliance",
  OPERATIONS = "operations",
  SYSTEM = "system",
  MEMBER = "member",
  FINANCIAL = "financial"
}

export interface NotificationMetadata {
  // ì—°ê´€ëœ ë¦¬ì†ŒìŠ¤ ì •ë³´
  memberId?: string;
  memberName?: string;
  withdrawalId?: string;
  depositId?: string;
  vaultId?: string;
  transactionId?: string;

  // ìˆ˜ì¹˜ ì •ë³´
  amount?: string;
  amountInKRW?: string;
  assetSymbol?: string;

  // ìƒíƒœ ì •ë³´
  previousStatus?: string;
  currentStatus?: string;

  // ìœ„í—˜ë„ ì •ë³´
  riskScore?: number;
  alertLevel?: string;

  // ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸
  ipAddress?: string;
  userAgent?: string;
  location?: string;

  // ìë™í™” ì •ë³´
  isAutoGenerated: boolean;
  sourceSystem?: string;
  correlationId?: string;
}

// ì•Œë¦¼ ì„¤ì •
export interface AdminNotificationSettings {
  userId: string;
  globalEnabled: boolean;
  channelSettings: NotificationChannelSettings[];
  typeSettings: NotificationTypeSettings[];
  scheduleSettings: NotificationScheduleSettings;
  updatedAt: Date;
}

export interface NotificationChannelSettings {
  channel: NotificationChannel;
  enabled: boolean;
  priorityFilter: AdminNotificationPriority[];
  categoryFilter: NotificationCategory[];
  endpoint?: string; // Email, Slack webhook, etc.
}

export enum NotificationChannel {
  WEB_PUSH = "web_push",     // ë¸Œë¼ìš°ì € ì•Œë¦¼
  EMAIL = "email",           // ì´ë©”ì¼
  SLACK = "slack",           // Slack ë©”ì‹œì§€
  SMS = "sms",               // SMS (ê¸´ê¸‰ìš©)
  TELEGRAM = "telegram",     // Telegram ë©”ì‹œì§€
  WEBHOOK = "webhook"        // ì»¤ìŠ¤í…€ ì›¹í›…
}

export interface NotificationTypeSettings {
  type: AdminNotificationType;
  enabled: boolean;
  channels: NotificationChannel[];
  autoAcknowledge: boolean;
  escalationMinutes?: number; // ë¯¸í™•ì¸ ì‹œ ìƒê¸‰ìì—ê²Œ ì—ìŠ¤ì»¬ë ˆì´ì…˜
}

export interface NotificationScheduleSettings {
  businessHoursOnly: boolean;
  businessHours: {
    start: string; // "09:00"
    end: string;   // "18:00"
    timezone: string;
  };
  weekendsEnabled: boolean;
  holidaysEnabled: boolean;
  doNotDisturbHours?: {
    start: string; // "22:00"
    end: string;   // "07:00"
  };
}

// ì•Œë¦¼ í†µê³„ ë° ë¶„ì„
export interface NotificationStats {
  timeRange: {
    start: Date;
    end: Date;
  };
  totalCount: number;
  unreadCount: number;
  byPriority: Record<AdminNotificationPriority, number>;
  byCategory: Record<NotificationCategory, number>;
  byType: Record<AdminNotificationType, number>;
  responseTimeStats: {
    averageAcknowledgeTime: number; // minutes
    medianAcknowledgeTime: number;
    overdueCount: number;
  };
  escalationStats: {
    totalEscalations: number;
    escalationRate: number; // %
    avgEscalationTime: number; // minutes
  };
}

// ì•Œë¦¼ ì•¡ì…˜
export interface NotificationAction {
  id: string;
  label: string;
  type: NotificationActionType;
  style: ActionStyle;
  url?: string;
  confirmationRequired: boolean;
  confirmationMessage?: string;
  requiredPermissions?: string[];
}

export enum NotificationActionType {
  NAVIGATE = "navigate",     // í˜ì´ì§€ ì´ë™
  API_CALL = "api_call",     // API í˜¸ì¶œ
  MODAL = "modal",           // ëª¨ë‹¬ ì—´ê¸°
  ACKNOWLEDGE = "acknowledge", // í™•ì¸ ì²˜ë¦¬
  DISMISS = "dismiss"        // ë¬´ì‹œ
}

export enum ActionStyle {
  PRIMARY = "primary",       // ì£¼ìš” ì•¡ì…˜
  SECONDARY = "secondary",   // ë³´ì¡° ì•¡ì…˜
  SUCCESS = "success",       // ì„±ê³µ ì•¡ì…˜
  WARNING = "warning",       // ê²½ê³  ì•¡ì…˜
  DANGER = "danger"          // ìœ„í—˜ ì•¡ì…˜
}

// ì•Œë¦¼ í…œí”Œë¦¿
export interface NotificationTemplate {
  id: string;
  type: AdminNotificationType;
  title: string;
  message: string;
  priority: AdminNotificationPriority;
  category: NotificationCategory;
  actions?: NotificationAction[];
  variables: string[]; // í…œí”Œë¦¿ ë³€ìˆ˜ ëª©ë¡
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// ì•Œë¦¼ ê·œì¹™ ì—”ì§„
export interface NotificationRule {
  id: string;
  name: string;
  description: string;
  conditions: NotificationCondition[];
  actions: NotificationRuleAction[];
  isActive: boolean;
  priority: number; // ê·œì¹™ ìš°ì„ ìˆœìœ„
  createdAt: Date;
  updatedAt: Date;
  lastTriggered?: Date;
  triggerCount: number;
}

export interface NotificationCondition {
  field: string;
  operator: ConditionOperator;
  value: any;
  logicalOperator?: LogicalOperator; // AND, OR for multiple conditions
}

export enum ConditionOperator {
  EQUALS = "equals",
  NOT_EQUALS = "not_equals",
  GREATER_THAN = "greater_than",
  LESS_THAN = "less_than",
  CONTAINS = "contains",
  NOT_CONTAINS = "not_contains",
  IN = "in",
  NOT_IN = "not_in"
}

export enum LogicalOperator {
  AND = "and",
  OR = "or"
}

export interface NotificationRuleAction {
  type: RuleActionType;
  priority: AdminNotificationPriority;
  channels: NotificationChannel[];
  template?: string;
  customMessage?: string;
  delay?: number; // minutes
  escalate?: boolean;
}

export enum RuleActionType {
  CREATE_NOTIFICATION = "create_notification",
  SEND_EMAIL = "send_email",
  SEND_SLACK = "send_slack",
  CALL_WEBHOOK = "call_webhook",
  ESCALATE = "escalate",
  AUTO_ACKNOWLEDGE = "auto_acknowledge"
}

// ì‹¤ì‹œê°„ ì•Œë¦¼ ìƒíƒœ
export interface NotificationState {
  unreadCount: number;
  criticalCount: number;
  lastUpdate: Date;
  connectionStatus: ConnectionStatus;
  subscriptions: NotificationSubscription[];
}

export enum ConnectionStatus {
  CONNECTED = "connected",
  CONNECTING = "connecting",
  DISCONNECTED = "disconnected",
  ERROR = "error"
}

export interface NotificationSubscription {
  userId: string;
  channels: NotificationChannel[];
  filters: NotificationFilter[];
  isActive: boolean;
}

export interface NotificationFilter {
  field: string;
  values: any[];
  exclude: boolean;
}

// API ìš”ì²­/ì‘ë‹µ íƒ€ì…
export interface GetNotificationsRequest {
  limit?: number;
  offset?: number;
  unreadOnly?: boolean;
  priority?: AdminNotificationPriority[];
  category?: NotificationCategory[];
  type?: AdminNotificationType[];
  since?: Date;
}

export interface GetNotificationsResponse {
  notifications: AdminNotification[];
  total: number;
  unreadCount: number;
  hasMore: boolean;
}

export interface AcknowledgeNotificationRequest {
  notificationIds: string[];
  acknowledgedBy: string;
}

export interface NotificationPreferencesRequest {
  settings: Partial<AdminNotificationSettings>;
}